<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ê³µì§€ëŠ¥ ìˆ˜í•™: K-í‰ê·  êµ°ì§‘í™” íƒêµ¬</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        /* ìŠ¬ë¼ì´ë” ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid currentColor;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-teal-600 text-white p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                        </svg>
                    </div>
                    <span class="font-bold text-xl text-slate-900">AI Math: K-í‰ê·  êµ°ì§‘í™” ì‹œë®¬ë ˆì´í„°</span>
                </div>
                <div class="flex items-center">
                    <span class="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full">ë¹„ì§€ë„ í•™ìŠµ ê¸°ì´ˆ</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- ì‹œë®¬ë ˆì´í„° ë©”ì¸ ì„¹ì…˜ -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
            
            <!-- ì™¼ìª½: ì¸í„°ë™í‹°ë¸Œ ìº”ë²„ìŠ¤ (8ì¹¸ ì°¨ì§€) -->
            <div class="lg:col-span-8 space-y-4">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-1 relative overflow-hidden group">
                    <canvas id="mainCanvas" class="w-full h-[400px] md:h-[500px] bg-white cursor-crosshair touch-none"></canvas>
                    
                    <!-- ì•ˆë‚´ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ -->
                    <div id="guideMsg" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none transition-opacity duration-500 opacity-100">
                        <div class="bg-teal-50/90 text-teal-700 px-6 py-4 rounded-xl shadow-lg border border-teal-100 backdrop-blur-sm">
                            <p class="font-bold text-lg mb-1">ğŸ‘† í™”ë©´ì„ í´ë¦­í•´ ë°ì´í„° ì ì„ ì¶”ê°€í•˜ì„¸ìš”!</p>
                            <p class="text-sm">ì  3ê°œ ì´ìƒì„ ì°ê³  ì„¤ì •ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between items-center text-sm text-slate-500 px-2">
                    <p>ğŸ’¡ Tip: êµ°ì§‘í™”ëŠ” **ì¤‘ì‹¬ì  ì´ˆê¸°í™”** í›„ **ë‹¨ê³„ ì§„í–‰**ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.</p>
                    <button id="btnClear" class="text-red-500 hover:text-red-700 hover:underline flex items-center gap-1 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        ëª¨ë“  ë°ì´í„° ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì»¨íŠ¸ë¡¤ íŒ¨ë„ (4ì¹¸ ì°¨ì§€) -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- ìƒíƒœ ì¹´ë“œ -->
                <div class="bg-white rounded-2xl shadow-lg border border-teal-100 p-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-2 h-full bg-teal-500"></div>
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-2">Algorithm Status</h3>
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-slate-700">í˜„ì¬ ë°˜ë³µ íšŸìˆ˜ (Iteration)</span>
                        <span id="dispIter" class="text-3xl font-bold text-teal-600">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-slate-700">WCSS (Loss)</span>
                        <span id="dispWCSS" class="text-xl font-mono text-slate-800">âˆ</span>
                    </div>
                </div>

                <!-- K ì„¤ì • ë° ì´ˆê¸°í™” -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-4">
                    <h3 class="font-bold text-slate-700 border-b pb-2">K (êµ°ì§‘ ê°œìˆ˜) ì„¤ì •</h3>
                    
                    <!-- K ìŠ¬ë¼ì´ë” -->
                    <div class="relative">
                        <div class="flex justify-between mb-2">
                            <label for="rangeK" class="font-bold text-teal-700 flex items-center gap-2">
                                <span>êµ°ì§‘ ìˆ˜ (K)</span>
                            </label>
                            <span id="dispK" class="text-xl font-bold text-teal-600">3</span>
                        </div>
                        <input type="range" id="rangeK" min="2" max="5" step="1" value="3" class="w-full accent-teal-600 text-teal-600">
                    </div>

                    <button id="btnInit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transform active:scale-95 transition-all flex items-center justify-center gap-2 mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0116 0V3a1 1 0 112 0v2.101a7.002 7.002 0 01-20 0V3a1 1 0 011-1zm3 10a1 1 0 100 2h.01a1 1 0 100-2H7zm2 5a1 1 0 100 2h.01a1 1 0 100-2H9zm4-5a1 1 0 100 2h.01a1 1 0 100-2H13zm2 5a1 1 0 100 2h.01a1 1 0 100-2H15z" clip-rule="evenodd" />
                        </svg>
                        ì¤‘ì‹¬ì  (Centroid) ì´ˆê¸°í™”
                    </button>
                </div>

                <!-- í•™ìŠµ ì»¨íŠ¸ë¡¤ -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-4">
                    <h3 class="font-bold text-slate-700 border-b pb-2">êµ°ì§‘í™” í•™ìŠµ ì§„í–‰</h3>

                    <button id="btnStep" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-md transform active:scale-95 transition-all flex items-center justify-center gap-2" disabled>
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                        </svg>
                        ì•Œê³ ë¦¬ì¦˜ ë‹¨ê³„ ì§„í–‰ (1 Step)
                    </button>
                    
                    <button id="btnAuto" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transform active:scale-95 transition-all flex items-center justify-center gap-2" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        ìˆ˜ë ´í•  ë•Œê¹Œì§€ ìë™ ì‹¤í–‰
                    </button>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨: í•™ìŠµ ìë£Œ (ê°œë… ì„¤ëª…) -->
        <div class="border-t border-slate-200 pt-12">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">ğŸ“š K-í‰ê·  êµ°ì§‘í™” í•µì‹¬ ê°œë…</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <!-- ì¹´ë“œ 1: K-í‰ê·  -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center mb-4 text-teal-600 font-bold text-xl">K</div>
                    <h3 class="font-bold text-lg mb-2">K-í‰ê·  êµ°ì§‘í™”ë€?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì •í•œ ê°œìˆ˜(<span class="font-bold">K</span>)ì˜ êµ°ì§‘ìœ¼ë¡œ ë¬¶ëŠ” ë¹„ì§€ë„ í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤. 
                        ë¹„ìŠ·í•œ ë°ì´í„°ë¼ë¦¬ ëª¨ì•„ ê·¸ë£¹ì˜ íŠ¹ì§•ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤.
                    </p>
                </div>
                <!-- ì¹´ë“œ 2: WCSS -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center mb-4 text-pink-600 font-bold text-xl">E</div>
                    <h3 class="font-bold text-lg mb-2">WCSS (ì˜¤ì°¨)</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        'Within-Cluster Sum of Squares'ì˜ ì•½ìë¡œ, ê° ë°ì´í„° ì ê³¼ ìì‹ ì´ ì†í•œ êµ°ì§‘ ì¤‘ì‹¬ì  ì‚¬ì´ì˜ ê±°ë¦¬ ì œê³±ì˜ í•©ì…ë‹ˆë‹¤. 
                        <span class="font-bold">ì‘ì„ìˆ˜ë¡</span> êµ°ì§‘ì´ ì˜ í˜•ì„±ë˜ì—ˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
                    </p>
                </div>
                <!-- ì¹´ë“œ 3: 2ë‹¨ê³„ í•™ìŠµ -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mb-4 text-blue-600 font-bold text-xl">âš™ï¸</div>
                    <h3 class="font-bold text-lg mb-2">ë°˜ë³µ í•™ìŠµ ê³¼ì •</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        â‘  **í• ë‹¹(Assignment):** ëª¨ë“  ì ì„ ê°€ì¥ ê°€ê¹Œìš´ ì¤‘ì‹¬ì ì— ë°°ì •. 
                        â‘¡ **ê°±ì‹ (Update):** ìƒˆë¡œìš´ êµ°ì§‘ì˜ í‰ê·  ìœ„ì¹˜ë¡œ ì¤‘ì‹¬ì ì„ ì´ë™. 
                        ì´ ë‘ ë‹¨ê³„ë¥¼ ì¤‘ì‹¬ì ì˜ ìœ„ì¹˜ê°€ ë” ì´ìƒ ë³€í•˜ì§€ ì•Šì„ ë•Œê¹Œì§€ ë°˜ë³µí•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
        

    </main>

    <footer class="bg-slate-900 text-slate-400 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">AI Education Project - K-Means</p>
            <p class="text-xs">HTML5 Canvas & JavaScript | No External Libraries Required</p>
        </div>
    </footer>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì „ì—­ ë²”ìœ„ ì˜¤ì—¼ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ IIFE(ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜)ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
        (function() {
            // --- ì „ì—­ ë³€ìˆ˜ (í•¨ìˆ˜ ë‚´ë¶€ì—ì„œë§Œ ìœ íš¨) ---
            const canvas = document.getElementById('mainCanvas');
            const ctx = canvas.getContext('2d');
            const guideMsg = document.getElementById('guideMsg');

            // K-Means ìƒíƒœ
            let dataPoints = [];
            let centroids = [];
            let K = 3;
            let iteration = 0;
            let isClusteringRunning = false;
            
            // ì¢Œí‘œ ì„¤ì • (ë…¼ë¦¬ì  ì¢Œí‘œ -10 ~ 10)
            const VIEW_RANGE = 10;
            let scaleX, scaleY, originX, originY;

            // UI ìš”ì†Œ
            const ui = {
                dispK: document.getElementById('dispK'),
                rangeK: document.getElementById('rangeK'),
                dispIter: document.getElementById('dispIter'),
                dispWCSS: document.getElementById('dispWCSS'),
                btnInit: document.getElementById('btnInit'),
                btnStep: document.getElementById('btnStep'),
                btnAuto: document.getElementById('btnAuto'),
                btnClear: document.getElementById('btnClear'),
            };

            // êµ°ì§‘ ìƒ‰ìƒ (K=5ê¹Œì§€)
            const CLUSTER_COLORS = [
                '#10b981', // Emerald-500 (K=0)
                '#3b82f6', // Blue-500 (K=1)
                '#f97316', // Orange-500 (K=2)
                '#a855f7', // Violet-500 (K=3)
                '#ef4444', // Red-500 (K=4)
            ];

            // --- ì´ˆê¸°í™” ---
            function init() {
                resize();
                window.addEventListener('resize', resize);
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                canvas.addEventListener('pointerdown', handleCanvasClick);
                
                ui.rangeK.addEventListener('input', (e) => {
                    K = parseInt(e.target.value);
                    ui.dispK.innerText = K;
                    resetClustering();
                });
                
                ui.btnInit.addEventListener('click', initCentroids);
                ui.btnStep.addEventListener('click', runKMeansStep);
                ui.btnAuto.addEventListener('click', toggleAutoRun);
                
                ui.btnClear.addEventListener('click', () => {
                    dataPoints = [];
                    resetClustering();
                    guideMsg.style.opacity = '1';
                });
                
                draw();
            }

            // --- í™”ë©´ í¬ê¸° ì¡°ì • ---
            function resize() {
                const parent = canvas.parentElement;
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight || 500;
                
                originX = canvas.width / 2;
                originY = canvas.height / 2;
                
                // ì¢Œí‘œ ìŠ¤ì¼€ì¼ ì„¤ì •
                const minDim = Math.min(canvas.width, canvas.height);
                scaleX = (minDim - 60) / (VIEW_RANGE * 2); 
                scaleY = (minDim - 60) / (VIEW_RANGE * 2);
                
                draw();
            }

            // --- ì¢Œí‘œ ë³€í™˜ ---
            const toScreen = (x, y) => ({
                x: originX + x * scaleX,
                y: originY - y * scaleY
            });
            
            const toLogical = (sx, sy) => ({
                x: (sx - originX) / scaleX,
                y: -(sy - originY) / scaleY
            });

            // --- K-Means ë¡œì§ ---

            // ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚°
            function distance(p1, p2) {
                return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
            }

            // í´ëŸ¬ìŠ¤í„°ë§ ìƒíƒœ ì´ˆê¸°í™” (ë°ì´í„°ëŠ” ìœ ì§€)
            function resetClustering() {
                centroids = [];
                iteration = 0;
                isClusteringRunning = false;
                
                dataPoints.forEach(p => p.cluster = -1); // í´ëŸ¬ìŠ¤í„° í• ë‹¹ ì´ˆê¸°í™”
                
                updateUI();
                draw();
            }

            // 1. ì¤‘ì‹¬ì  ì´ˆê¸°í™” (ëœë¤)
            function initCentroids() {
                if (dataPoints.length < K) {
                    alert(`ë°ì´í„° ì ì´ ${K}ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.`);
                    return;
                }
                
                // ê¸°ì¡´ ì¤‘ì‹¬ì  ì œê±° ë° ë°˜ë³µ íšŸìˆ˜ ì´ˆê¸°í™”
                centroids = [];
                iteration = 0;
                
                // K-Means++ ë°©ì‹ìœ¼ë¡œ ì´ˆê¸°í™” (ì¢€ ë” ë‚˜ì€ ì„±ëŠ¥) ëŒ€ì‹  ê°„ë‹¨í•œ ëœë¤ ì„ íƒ ì‚¬ìš©
                const shuffledPoints = [...dataPoints].sort(() => 0.5 - Math.random());
                for (let i = 0; i < K; i++) {
                    // ë°ì´í„° ì  ì¤‘ì—ì„œ Kê°œë¥¼ ì„ íƒí•˜ì—¬ ì´ˆê¸° ì¤‘ì‹¬ì ìœ¼ë¡œ ì„¤ì •
                    centroids.push({
                        x: shuffledPoints[i].x,
                        y: shuffledPoints[i].y,
                        id: i
                    });
                }

                // ë²„íŠ¼ í™œì„±í™”
                ui.btnStep.disabled = false;
                ui.btnAuto.disabled = false;
                
                // ì´ˆê¸° í• ë‹¹ (0ë‹¨ê³„)
                assignClusters(); 
                
                updateUI();
                draw();
            }

            // 2. í• ë‹¹ ë‹¨ê³„ (Assignment Step)
            function assignClusters() {
                let changed = false;
                dataPoints.forEach(p => {
                    let minDistance = Infinity;
                    let newCluster = -1;
                    
                    centroids.forEach(c => {
                        const dist = distance(p, c);
                        if (dist < minDistance) {
                            minDistance = dist;
                            newCluster = c.id;
                        }
                    });
                    
                    if (p.cluster !== newCluster) {
                        p.cluster = newCluster;
                        changed = true;
                    }
                });
                return changed;
            }

            // 3. ê°±ì‹  ë‹¨ê³„ (Update Step)
            function updateCentroids() {
                const newCentroidsData = Array(K).fill(0).map(() => ({ sumX: 0, sumY: 0, count: 0 }));
                
                dataPoints.forEach(p => {
                    const id = p.cluster;
                    if (id !== -1) {
                        newCentroidsData[id].sumX += p.x;
                        newCentroidsData[id].sumY += p.y;
                        newCentroidsData[id].count += 1;
                    }
                });

                let moved = false;
                centroids.forEach(c => {
                    const data = newCentroidsData[c.id];
                    if (data.count > 0) {
                        const newX = data.sumX / data.count;
                        const newY = data.sumY / data.count;

                        if (distance(c, {x: newX, y: newY}) > 1e-5) {
                            c.x = newX;
                            c.y = newY;
                            moved = true;
                        }
                    } else {
                        // í• ë‹¹ëœ ì ì´ ì—†ëŠ” ê²½ìš°, ì¤‘ì‹¬ì ì„ ë¬´ì‘ìœ„ë¡œ ì¬ë°°ì¹˜ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ ì‹œë®¬ë ˆì´í„°ë¥¼ ìœ„í•´)
                        // console.warn(`Centroid ${c.id} lost all points. Re-initializing.`);
                        // c.x = Math.random() * VIEW_RANGE * 2 - VIEW_RANGE;
                        // c.y = Math.random() * VIEW_RANGE * 2 - VIEW_RANGE;
                        // moved = true;
                    }
                });
                return moved;
            }
            
            // 4. ì˜¤ì°¨ ê³„ì‚° (WCSS)
            function calculateWCSS() {
                if (dataPoints.length === 0 || centroids.length === 0) return Infinity;
                
                let totalWCSS = 0;
                dataPoints.forEach(p => {
                    const c = centroids.find(c => c.id === p.cluster);
                    if (c) {
                        totalWCSS += Math.pow(distance(p, c), 2);
                    }
                });
                return totalWCSS;
            }

            // K-Means ë‹¨ê³„ ì§„í–‰ (Assignment -> Update)
            function runKMeansStep() {
                if (centroids.length === 0) {
                    alert("ì¤‘ì‹¬ì ì„ ë¨¼ì € ì´ˆê¸°í™”í•˜ì„¸ìš”.");
                    return;
                }
                
                // 1. í• ë‹¹ (Assignment)
                assignClusters();
                draw();
                
                // 2. ê°±ì‹  (Update)
                const moved = updateCentroids();
                iteration++;

                // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•´ ì ì‹œ ì§€ì—° í›„ ê·¸ë¦¬ê¸°
                setTimeout(() => {
                    updateUI();
                    draw();
                    
                    if (!moved) {
                        // ìˆ˜ë ´
                        stopAutoRun();
                        alert("K-í‰ê·  ì•Œê³ ë¦¬ì¦˜ì´ ìˆ˜ë ´í–ˆìŠµë‹ˆë‹¤!");
                    }
                }, 100); 

                return moved;
            }
            
            // ìë™ ì‹¤í–‰
            let autoRunInterval = null;

            function toggleAutoRun() {
                if (isClusteringRunning) {
                    stopAutoRun();
                } else {
                    startAutoRun();
                }
            }

            function startAutoRun() {
                if (centroids.length === 0) {
                    initCentroids();
                }
                
                isClusteringRunning = true;
                ui.btnAuto.innerText = "ìë™ ì‹¤í–‰ ì¤‘ì§€";
                ui.btnAuto.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                ui.btnAuto.classList.add('bg-red-500', 'hover:bg-red-600');
                ui.btnStep.disabled = true;
                
                autoRunInterval = setInterval(() => {
                    const moved = runKMeansStep();
                    if (!moved) {
                        stopAutoRun();
                    }
                }, 500); // 0.5ì´ˆ ê°„ê²©
            }

            function stopAutoRun() {
                clearInterval(autoRunInterval);
                isClusteringRunning = false;
                ui.btnAuto.innerText = "ìˆ˜ë ´í•  ë•Œê¹Œì§€ ìë™ ì‹¤í–‰";
                ui.btnAuto.classList.remove('bg-red-500', 'hover:bg-red-600');
                ui.btnAuto.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
                ui.btnStep.disabled = false;
            }


            // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
            function handleCanvasClick(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const p = toLogical(x, y);
                
                // ë²”ìœ„ ì œí•œ
                if(Math.abs(p.x) > VIEW_RANGE || Math.abs(p.y) > VIEW_RANGE) return;
                
                dataPoints.push({ x: p.x, y: p.y, cluster: -1 });
                
                // ì•ˆë‚´ ë©”ì‹œì§€ ìˆ¨ê¹€
                if(dataPoints.length > 0) guideMsg.style.opacity = '0';
                
                // ë°ì´í„° ì¶”ê°€ ì‹œ í´ëŸ¬ìŠ¤í„°ë§ ìƒíƒœ ë¦¬ì…‹
                if (centroids.length > 0) resetClustering();
                
                updateUI();
                draw();
            }

            // --- UI ì—…ë°ì´íŠ¸ ---
            function updateUI() {
                ui.dispIter.innerText = iteration;
                const wcss = calculateWCSS();
                ui.dispWCSS.innerText = wcss === Infinity ? 'âˆ' : wcss.toFixed(3);
                
                // ë°ì´í„°ê°€ 1ê°œ ë¯¸ë§Œì´ë©´ ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
                if (dataPoints.length === 0) {
                    ui.btnInit.disabled = true;
                    ui.btnStep.disabled = true;
                    ui.btnAuto.disabled = true;
                } else {
                    ui.btnInit.disabled = false;
                }
            }
            
            // --- ê·¸ë¦¬ê¸° ---
            function draw() {
                // ì´ˆê¸°í™”
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ê·¸ë¦¬ë“œ ë° ì¶• (ìƒëµ, ê°„ê²°í•¨ì„ ìœ„í•´)
                ctx.strokeStyle = '#e2e8f0'; // Slate-200
                ctx.lineWidth = 1;

                // ë°ì´í„° ì 
                dataPoints.forEach(p => {
                    const s = toScreen(p.x, p.y);
                    
                    // ì  ìƒ‰ìƒ (í´ëŸ¬ìŠ¤í„°ì— ë”°ë¼)
                    const color = p.cluster !== -1 ? CLUSTER_COLORS[p.cluster % CLUSTER_COLORS.length] : '#1e293b'; // Slate-800
                    
                    ctx.beginPath();
                    ctx.fillStyle = color;
                    ctx.arc(s.x, s.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ì  í…Œë‘ë¦¬
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                });

                // ì¤‘ì‹¬ì  (Centroids)
                centroids.forEach(c => {
                    const s = toScreen(c.x, c.y);
                    const color = CLUSTER_COLORS[c.id % CLUSTER_COLORS.length];
                    
                    // ì¤‘ì‹¬ì  ì™¸ê³½ì„  (ë‘êº¼ìš´ ë§)
                    ctx.beginPath();
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 4;
                    ctx.arc(s.x, s.y, 10, 0, Math.PI * 2);
                    ctx.stroke();

                    // ë‚´ë¶€ ì±„ìš°ê¸° (í°ìƒ‰)
                    ctx.beginPath();
                    ctx.fillStyle = 'white';
                    ctx.arc(s.x, s.y, 6, 0, Math.PI * 2);
                    ctx.fill();

                    // ì¤‘ì‹¬ì  í‘œì‹œ (X)
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(s.x - 4, s.y - 4);
                    ctx.lineTo(s.x + 4, s.y + 4);
                    ctx.moveTo(s.x + 4, s.y - 4);
                    ctx.lineTo(s.x - 4, s.y + 4);
                    ctx.stroke();
                });
            }

            // ì‹¤í–‰
            init();

        })();
    </script>
</body>
</html>
