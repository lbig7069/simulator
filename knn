<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ê³µì§€ëŠ¥ ìˆ˜í•™: K-ìµœê·¼ì ‘ ì´ì›ƒ íƒêµ¬</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        /* ìŠ¬ë¼ì´ë” ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid currentColor;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-violet-600 text-white p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-3m-6 3h6v-3m1-9v9h-5v-9m-1 9l-1 1-2 2-2-2-1-1m1-9h6v-3m1 3v9m-1-9l1 1 2 2 2-2 1-1" />
                        </svg>
                    </div>
                    <span class="font-bold text-xl text-slate-900">AI Math: K-ìµœê·¼ì ‘ ì´ì›ƒ ì‹œë®¬ë ˆì´í„°</span>
                </div>
                <div class="flex items-center">
                    <span class="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full">ì§€ë„ í•™ìŠµ ê¸°ì´ˆ</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- ì‹œë®¬ë ˆì´í„° ë©”ì¸ ì„¹ì…˜ -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
            
            <!-- ì™¼ìª½: ì¸í„°ë™í‹°ë¸Œ ìº”ë²„ìŠ¤ (8ì¹¸ ì°¨ì§€) -->
            <div class="lg:col-span-8 space-y-4">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-1 relative overflow-hidden group">
                    <canvas id="mainCanvas" class="w-full h-[400px] md:h-[500px] bg-white cursor-crosshair touch-none"></canvas>
                    
                    <!-- ì•ˆë‚´ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ -->
                    <div id="guideMsg" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none transition-opacity duration-500 opacity-100">
                        <div class="bg-violet-50/90 text-violet-700 px-6 py-4 rounded-xl shadow-lg border border-violet-100 backdrop-blur-sm">
                            <p class="font-bold text-lg mb-1">í´ë¦­í•˜ì—¬ í•™ìŠµ ë°ì´í„° (í´ë˜ìŠ¤ A/B)ë¥¼ ì¶”ê°€í•˜ì„¸ìš”!</p>
                            <p class="text-sm">A/B ì „í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë°ì´í„°ë¥¼ 5ê°œ ì´ìƒ ì°ì–´ë³´ì„¸ìš”.</p>
                        </div>
                    </div>

                    <!-- í´ë˜ìŠ¤ A/B ì „í™˜ ë²„íŠ¼ -->
                    <div class="absolute top-4 left-4 z-10">
                        <div class="flex items-center space-x-2 bg-white p-3 rounded-xl shadow-lg border border-slate-200">
                            <span class="text-sm font-semibold text-slate-700">ì¶”ê°€í•  ë°ì´í„° í´ë˜ìŠ¤:</span>
                            <button id="btnToggleClass" class="flex items-center gap-2 px-3 py-1.5 rounded-lg font-bold transition-colors shadow">
                                <span id="currentClassDisplay" class="text-white text-base">A</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between items-center text-sm text-slate-500 px-2">
                    <p>ğŸ’¡ Tip: ë¶„ë¥˜í•  ì ì„ ì¶”ê°€í•˜ë ¤ë©´ **ë¶„ë¥˜í•  ì  ì°ê¸°**ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
                    <button id="btnClear" class="text-red-500 hover:text-red-700 hover:underline flex items-center gap-1 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        ëª¨ë“  ë°ì´í„° ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì»¨íŠ¸ë¡¤ íŒ¨ë„ (4ì¹¸ ì°¨ì§€) -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- K ì„¤ì • ë° ë¯¸ë¶„ë¥˜ ì  ì¶”ê°€ -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-4">
                    <h3 class="font-bold text-slate-700 border-b pb-2">K (ì´ì›ƒ ìˆ˜) ì„¤ì •</h3>
                    
                    <!-- K ìŠ¬ë¼ì´ë” -->
                    <div class="relative">
                        <div class="flex justify-between mb-2">
                            <label for="rangeK" class="font-bold text-violet-700 flex items-center gap-2">
                                <span>ì´ì›ƒ ìˆ˜ (K)</span>
                            </label>
                            <span id="dispK" class="text-xl font-bold text-violet-600">3</span>
                        </div>
                        <input type="range" id="rangeK" min="1" max="9" step="2" value="3" class="w-full accent-violet-600 text-violet-600">
                        <p class="text-xs text-slate-400 mt-1">KëŠ” ë³´í†µ í™€ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </div>

                    <!-- ë¶„ë¥˜í•  ì  ëª¨ë“œ í† ê¸€ -->
                    <button id="btnToggleMode" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-md transform active:scale-95 transition-all flex items-center justify-center gap-2 mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13l3-3 3 3m2-4H7a4 4 0 00-4 4v2m17 0v-2a4 4 0 00-4-4H9" />
                        </svg>
                        ë¶„ë¥˜í•  ì  ì°ê¸° ëª¨ë“œ (í˜„ì¬: í•™ìŠµ ë°ì´í„° ì¶”ê°€)
                    </button>
                </div>

                <!-- ë¶„ë¥˜ ê²°ê³¼ ì¹´ë“œ -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-2 h-full bg-lime-500"></div>
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-2">Classification Result</h3>
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-slate-700">ì˜ˆì¸¡ëœ í´ë˜ìŠ¤</span>
                        <span id="predictedClass" class="text-4xl font-bold text-slate-400">?</span>
                    </div>
                    <div id="resultDetails" class="text-sm text-slate-600 mt-4 space-y-1">
                        <!-- ìƒì„¸ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                        <p>K-ìµœê·¼ì ‘ ì´ì›ƒì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë ¤ë©´ ë¶„ë¥˜í•  ì ì„ ì°ì–´ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨: í•™ìŠµ ìë£Œ (ê°œë… ì„¤ëª…) -->
        <div class="border-t border-slate-200 pt-12">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">ğŸ“š K-ìµœê·¼ì ‘ ì´ì›ƒ ì•Œê³ ë¦¬ì¦˜ í•µì‹¬ ê°œë…</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <!-- ì¹´ë“œ 1: KNN ì •ì˜ -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-violet-100 rounded-lg flex items-center justify-center mb-4 text-violet-600 font-bold text-xl">N</div>
                    <h3 class="font-bold text-lg mb-2">K-ìµœê·¼ì ‘ ì´ì›ƒì´ë€?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        ìƒˆë¡œìš´ ë°ì´í„°ì˜ í´ë˜ìŠ¤ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´, ê·¸ ì£¼ë³€ì˜ <span class="font-bold">ê°€ì¥ ê°€ê¹Œìš´ Kê°œì˜ ì´ì›ƒ</span>ì„ ì°¾ì•„ ê·¸ ì´ì›ƒë“¤ì´ ì†í•œ í´ë˜ìŠ¤ ì¤‘ **ë‹¤ìˆ˜ê²°**ë¡œ ê²°ì •í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
                    </p>
                </div>
                <!-- ì¹´ë“œ 2: K ê°’ì˜ ì¤‘ìš”ì„± -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-fuchsia-100 rounded-lg flex items-center justify-center mb-4 text-fuchsia-600 font-bold text-xl">K</div>
                    <h3 class="font-bold text-lg mb-2">K ê°’ ì„¤ì •ì˜ ì¤‘ìš”ì„±</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        K ê°’ì´ ì‘ìœ¼ë©´ (ì˜ˆ: K=1) ë…¸ì´ì¦ˆì— ë¯¼ê°í•´ì ¸ ê³¼ì í•©ë  ìˆ˜ ìˆê³ , K ê°’ì´ í¬ë©´ ê²½ê³„ê°€ ë‹¨ìˆœí•´ì ¸ ë„ˆë¬´ ì¼ë°˜í™”(ê³¼ì†Œì í•©)ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                        ì ì ˆí•œ Kë¥¼ ì°¾ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
                    </p>
                </div>
                <!-- ì¹´ë“œ 3: ê±°ë¦¬ ì¸¡ì • -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-lime-100 rounded-lg flex items-center justify-center mb-4 text-lime-600 font-bold text-xl">ğŸ“</div>
                    <h3 class="font-bold text-lg mb-2">ê±°ë¦¬ ì¸¡ì • (ìœ í´ë¦¬ë“œ ê±°ë¦¬)</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">
                        ì´ì›ƒì„ ì°¾ê¸° ìœ„í•´ì„œëŠ” ìƒˆë¡œìš´ ì ê³¼ ê¸°ì¡´ ë°ì´í„° ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤. 
                        ê°€ì¥ í”íˆ ì‚¬ìš©ë˜ëŠ” ê±°ë¦¬ëŠ” ë‘ ì  ì‚¬ì´ì˜ ì§ì„  ê±°ë¦¬ì¸ <span class="font-bold">ìœ í´ë¦¬ë“œ ê±°ë¦¬</span>ì…ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
        

    </main>

    <footer class="bg-slate-900 text-slate-400 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">AI Education Project - K-Nearest Neighbors</p>
            <p class="text-xs">HTML5 Canvas & JavaScript | No External Libraries Required</p>
        </div>
    </footer>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì „ì—­ ë²”ìœ„ ì˜¤ì—¼ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ IIFE(ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜)ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
        (function() {
            // --- ì „ì—­ ë³€ìˆ˜ (í•¨ìˆ˜ ë‚´ë¶€ì—ì„œë§Œ ìœ íš¨) ---
            const canvas = document.getElementById('mainCanvas');
            const ctx = canvas.getContext('2d');
            const guideMsg = document.getElementById('guideMsg');

            // KNN ìƒíƒœ
            let dataPoints = []; // í•™ìŠµ ë°ì´í„° {x, y, class}
            let testPoint = null; // ë¯¸ë¶„ë¥˜ ì  {x, y, predictedClass, neighbors}
            let K = 3;
            let currentClass = 'A'; // í˜„ì¬ ì°ì„ ë°ì´í„°ì˜ í´ë˜ìŠ¤ ('A' ë˜ëŠ” 'B')
            let currentMode = 'train'; // 'train' ë˜ëŠ” 'test' (í•™ìŠµ ë°ì´í„° ì¶”ê°€ ë˜ëŠ” ë¶„ë¥˜í•  ì  ì¶”ê°€)
            
            // ì¢Œí‘œ ì„¤ì • (ë…¼ë¦¬ì  ì¢Œí‘œ -10 ~ 10)
            const VIEW_RANGE = 10;
            let scaleX, scaleY, originX, originY;

            // UI ìš”ì†Œ
            const ui = {
                dispK: document.getElementById('dispK'),
                rangeK: document.getElementById('rangeK'),
                btnToggleClass: document.getElementById('btnToggleClass'),
                currentClassDisplay: document.getElementById('currentClassDisplay'),
                btnToggleMode: document.getElementById('btnToggleMode'),
                predictedClass: document.getElementById('predictedClass'),
                resultDetails: document.getElementById('resultDetails'),
                btnClear: document.getElementById('btnClear'),
            };

            // í´ë˜ìŠ¤ ìƒ‰ìƒ
            const CLASS_COLORS = {
                'A': { bg: '#8b5cf6', ring: '#a78bfa' }, // Violet-500
                'B': { bg: '#22c55e', ring: '#4ade80' }, // Green-500
                'TEST': { bg: '#facc15', ring: '#fde047' } // Yellow-400 (ë¯¸ë¶„ë¥˜)
            };

            // --- ì´ˆê¸°í™” ---
            function init() {
                resize();
                window.addEventListener('resize', resize);
                
                // ì´ˆê¸° í´ë˜ìŠ¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì„¤ì •
                updateClassButton();

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                canvas.addEventListener('pointerdown', handleCanvasClick);
                
                ui.rangeK.addEventListener('input', (e) => {
                    K = parseInt(e.target.value);
                    if (K > dataPoints.length && dataPoints.length > 0) {
                         // ë°ì´í„° ì  ê°œìˆ˜ë³´ë‹¤ Kê°€ í¬ë©´, Kë¥¼ ë°ì´í„° ì  ê°œìˆ˜ë¡œ ì œí•œí•˜ê±°ë‚˜ ê²½ê³ ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                         // ì—¬ê¸°ì„œëŠ” Kë¥¼ í™€ìˆ˜ ê·œì¹™ì— ë”°ë¼ 1ë¡œ ê°•ì œ ì„¤ì •í•©ë‹ˆë‹¤.
                         K = 1; 
                         ui.rangeK.value = 1;
                         alert("K ê°’ì€ í•™ìŠµ ë°ì´í„° ê°œìˆ˜ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. K=1ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.");
                    } else if (K % 2 === 0) {
                        // Kê°€ ì§ìˆ˜ê°€ ë˜ë©´, ë‹¤ìŒ í™€ìˆ˜ë¡œ ì¡°ì • (K=0ì€ ì—†ìœ¼ë¯€ë¡œ 1ë¶€í„° ì‹œì‘)
                        K = K + 1;
                        ui.rangeK.value = K;
                    }
                    ui.dispK.innerText = K;
                    classifyTestPoint(); // K ë³€ê²½ ì‹œ ì¦‰ì‹œ ì¬ë¶„ë¥˜
                    draw();
                });
                
                ui.btnToggleClass.addEventListener('click', toggleCurrentClass);
                ui.btnToggleMode.addEventListener('click', toggleMode);
                
                ui.btnClear.addEventListener('click', () => {
                    dataPoints = [];
                    testPoint = null;
                    resetClassificationDisplay();
                    guideMsg.style.opacity = '1';
                    draw();
                });
                
                draw();
            }

            // --- í™”ë©´ í¬ê¸° ì¡°ì • ---
            function resize() {
                const parent = canvas.parentElement;
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight || 500;
                
                originX = canvas.width / 2;
                originY = canvas.height / 2;
                
                // ì¢Œí‘œ ìŠ¤ì¼€ì¼ ì„¤ì •
                const minDim = Math.min(canvas.width, canvas.height);
                scaleX = (minDim - 60) / (VIEW_RANGE * 2); 
                scaleY = (minDim - 60) / (VIEW_RANGE * 2);
                
                draw();
            }

            // --- ì¢Œí‘œ ë³€í™˜ ---
            const toScreen = (x, y) => ({
                x: originX + x * scaleX,
                y: originY - y * scaleY
            });
            
            const toLogical = (sx, sy) => ({
                x: (sx - originX) / scaleX,
                y: -(sy - originY) / scaleY
            });

            // --- KNN ë¡œì§ ---

            // ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚°
            function distance(p1, p2) {
                return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
            }
            
            // ë¯¸ë¶„ë¥˜ ì  ë¶„ë¥˜
            function classifyTestPoint() {
                if (!testPoint || dataPoints.length === 0) {
                    resetClassificationDisplay();
                    return;
                }
                
                // 1. ëª¨ë“  í•™ìŠµ ë°ì´í„°ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
                const distances = dataPoints.map(p => ({
                    ...p,
                    dist: distance(testPoint, p)
                }));

                // 2. ê±°ë¦¬ì— ë”°ë¼ ì •ë ¬
                distances.sort((a, b) => a.dist - b.dist);

                // 3. Kê°œë§Œí¼ ì„ íƒ
                const kNeighbors = distances.slice(0, K);

                // 4. ë‹¤ìˆ˜ê²° íˆ¬í‘œ
                const vote = {};
                kNeighbors.forEach(p => {
                    vote[p.class] = (vote[p.class] || 0) + 1;
                });

                // 5. ê°€ì¥ ë§ì€ í‘œë¥¼ ë°›ì€ í´ë˜ìŠ¤ ê²°ì •
                let maxVotes = -1;
                let predictedClass = '?';
                let voteDetails = {};

                for (const className in vote) {
                    voteDetails[className] = vote[className];
                    if (vote[className] > maxVotes) {
                        maxVotes = vote[className];
                        predictedClass = className;
                    }
                }
                
                testPoint.predictedClass = predictedClass;
                testPoint.neighbors = kNeighbors;
                
                updateClassificationDisplay(predictedClass, voteDetails, K);
                draw();
            }
            
            // --- UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
            
            function updateClassButton() {
                const color = CLASS_COLORS[currentClass].bg;
                ui.btnToggleClass.style.backgroundColor = color;
                ui.currentClassDisplay.innerText = currentClass;
            }
            
            function toggleCurrentClass() {
                currentClass = (currentClass === 'A') ? 'B' : 'A';
                updateClassButton();
                // í•™ìŠµ ëª¨ë“œì¼ ë•Œë§Œ í´ë˜ìŠ¤ ì „í™˜ì´ ì˜ë¯¸ ìˆìŒ
                if (currentMode === 'test') toggleMode();
            }

            function toggleMode() {
                if (dataPoints.length < 1) {
                    alert("ë¶„ë¥˜í•  ì ì„ ì°ìœ¼ë ¤ë©´ í•™ìŠµ ë°ì´í„°(í´ë˜ìŠ¤ A, B)ê°€ ìµœì†Œ 1ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.");
                    return;
                }

                currentMode = (currentMode === 'train') ? 'test' : 'train';
                if (currentMode === 'test') {
                    ui.btnToggleMode.innerHTML = `
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19v-4m0 0H7a4 4 0 01-4-4v-2a4 4 0 014-4h4m0 0V3m0 0h4a4 4 0 014 4v2a4 4 0 01-4 4h-4m0 0v4m0 0h4a4 4 0 004-4v-2a4 4 0 00-4-4h-4" />
                        </svg>
                        í•™ìŠµ ë°ì´í„° ì¶”ê°€ ëª¨ë“œ (í˜„ì¬: ë¶„ë¥˜í•  ì  ì°ê¸°)
                    `;
                    ui.btnToggleMode.classList.add('bg-lime-600', 'hover:bg-lime-700');
                    ui.btnToggleMode.classList.remove('bg-slate-900', 'hover:bg-slate-800');
                    canvas.style.cursor = 'help';
                    if (testPoint) classifyTestPoint(); // ëª¨ë“œ ì „í™˜ ì‹œ ì¬ë¶„ë¥˜
                } else {
                    ui.btnToggleMode.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13l3-3 3 3m2-4H7a4 4 0 00-4 4v2m17 0v-2a4 4 0 00-4-4H9" />
                        </svg>
                        ë¶„ë¥˜í•  ì  ì°ê¸° ëª¨ë“œ (í˜„ì¬: í•™ìŠµ ë°ì´í„° ì¶”ê°€)
                    `;
                    ui.btnToggleMode.classList.remove('bg-lime-600', 'hover:bg-lime-700');
                    ui.btnToggleMode.classList.add('bg-slate-900', 'hover:bg-slate-800');
                    canvas.style.cursor = 'crosshair';
                    testPoint = null; // í•™ìŠµ ëª¨ë“œë¡œ ëŒì•„ì˜¤ë©´ ë¶„ë¥˜ì  ì´ˆê¸°í™”
                    resetClassificationDisplay();
                }
                draw();
            }

            function updateClassificationDisplay(predictedClass, voteDetails, K) {
                const color = CLASS_COLORS[predictedClass] ? CLASS_COLORS[predictedClass].bg : 'gray';
                ui.predictedClass.innerText = predictedClass;
                ui.predictedClass.style.color = color;
                
                let detailsHTML = `<p class="font-bold">K=${K} ì´ì›ƒë“¤ì˜ íˆ¬í‘œ ê²°ê³¼:</p><ul>`;
                for (const className in voteDetails) {
                    const classColor = CLASS_COLORS[className].bg;
                    detailsHTML += `<li class="flex justify-between items-center"><span style="color:${classColor};" class="font-bold">${className} í´ë˜ìŠ¤</span> <span>${voteDetails[className]}í‘œ</span></li>`;
                }
                detailsHTML += '</ul>';
                
                ui.resultDetails.innerHTML = detailsHTML;
            }
            
            function resetClassificationDisplay() {
                ui.predictedClass.innerText = '?';
                ui.predictedClass.style.color = 'rgb(148, 163, 184)'; // Slate-400
                ui.resultDetails.innerHTML = '<p>K-ìµœê·¼ì ‘ ì´ì›ƒì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë ¤ë©´ ë¶„ë¥˜í•  ì ì„ ì°ì–´ì£¼ì„¸ìš”.</p>';
            }

            // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
            function handleCanvasClick(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const p = toLogical(x, y);
                
                // ë²”ìœ„ ì œí•œ
                if(Math.abs(p.x) > VIEW_RANGE || Math.abs(p.y) > VIEW_RANGE) return;
                
                if (currentMode === 'train') {
                    // í•™ìŠµ ë°ì´í„° ì¶”ê°€
                    dataPoints.push({ x: p.x, y: p.y, class: currentClass });
                    
                    // ì•ˆë‚´ ë©”ì‹œì§€ ìˆ¨ê¹€
                    if(dataPoints.length > 0) guideMsg.style.opacity = '0';

                    // K ì œí•œ ì—…ë°ì´íŠ¸
                    if (K > dataPoints.length) {
                        K = dataPoints.length > 0 ? (dataPoints.length % 2 === 0 ? dataPoints.length - 1 : dataPoints.length) : 1;
                        if (K < 1) K = 1;
                        ui.rangeK.value = K;
                        ui.dispK.innerText = K;
                    }

                } else {
                    // ë¯¸ë¶„ë¥˜ ì  ì¶”ê°€ ë° ë¶„ë¥˜ ì‹¤í–‰
                    testPoint = { x: p.x, y: p.y, predictedClass: '?', neighbors: [] };
                    classifyTestPoint();
                }
                
                draw();
            }
            
            // --- ê·¸ë¦¬ê¸° ---
            function draw() {
                // ì´ˆê¸°í™”
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ê·¸ë¦¬ë“œ ë° ì¶• (ìƒëµ, ê°„ê²°í•¨ì„ ìœ„í•´)
                ctx.strokeStyle = '#e2e8f0'; // Slate-200
                ctx.lineWidth = 1;
                
                // í•™ìŠµ ë°ì´í„° ì 
                dataPoints.forEach(p => {
                    const s = toScreen(p.x, p.y);
                    const color = CLASS_COLORS[p.class].bg;
                    const ringColor = CLASS_COLORS[p.class].ring;
                    
                    // ì 
                    ctx.beginPath();
                    ctx.fillStyle = color;
                    ctx.arc(s.x, s.y, 7, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ì  í…Œë‘ë¦¬
                    ctx.strokeStyle = ringColor;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                // ë¯¸ë¶„ë¥˜ ì ê³¼ ìµœê·¼ì ‘ ì´ì›ƒ
                if (testPoint) {
                    const s = toScreen(testPoint.x, testPoint.y);
                    
                    // Kê°œ ì´ì›ƒ ì—°ê²°ì„  (ì ì„ )
                    if (testPoint.neighbors && testPoint.neighbors.length > 0) {
                        ctx.setLineDash([5, 5]);
                        ctx.lineWidth = 1.5;
                        ctx.strokeStyle = '#9ca3af'; // Gray-400
                        
                        testPoint.neighbors.forEach((neighbor, index) => {
                            // Kê°œì˜ ì´ì›ƒë§Œ í‘œì‹œ
                            if (index < K) {
                                const sNeighbor = toScreen(neighbor.x, neighbor.y);
                                ctx.beginPath();
                                ctx.moveTo(s.x, s.y);
                                ctx.lineTo(sNeighbor.x, sNeighbor.y);
                                ctx.stroke();
                                
                                // ì´ì›ƒì—ê²Œ ì‘ì€ ë§ í‘œì‹œ
                                ctx.beginPath();
                                ctx.strokeStyle = CLASS_COLORS[neighbor.class].bg;
                                ctx.lineWidth = 3;
                                ctx.arc(sNeighbor.x, sNeighbor.y, 9, 0, Math.PI * 2);
                                ctx.stroke();
                            }
                        });
                        ctx.setLineDash([]);
                    }
                    
                    // ë¯¸ë¶„ë¥˜ ì  (í° ë‹¤ì´ì•„ëª¬ë“œ ëª¨ì–‘)
                    const pointSize = 10;
                    const predictedColor = CLASS_COLORS[testPoint.predictedClass] ? CLASS_COLORS[testPoint.predictedClass].bg : CLASS_COLORS['TEST'].bg;
                    const ringColor = CLASS_COLORS[testPoint.predictedClass] ? CLASS_COLORS[testPoint.predictedClass].ring : CLASS_COLORS['TEST'].ring;

                    ctx.beginPath();
                    ctx.fillStyle = predictedColor;
                    ctx.moveTo(s.x, s.y - pointSize);
                    ctx.lineTo(s.x + pointSize, s.y);
                    ctx.lineTo(s.x, s.y + pointSize);
                    ctx.lineTo(s.x - pointSize, s.y);
                    ctx.closePath();
                    ctx.fill();

                    // í…Œë‘ë¦¬
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 3;
                    ctx.stroke();

                    // ì–‡ì€ ë°”ê¹¥ ë§ (ì˜ˆì¸¡ ê²°ê³¼ê°€ ëª…í™•í•  ê²½ìš°ì—ë§Œ)
                    ctx.strokeStyle = ringColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(s.x, s.y - pointSize - 3);
                    ctx.lineTo(s.x + pointSize + 3, s.y);
                    ctx.lineTo(s.x, s.y + pointSize + 3);
                    ctx.lineTo(s.x - pointSize - 3, s.y);
                    ctx.closePath();
                    ctx.stroke();
                }
            }

            // ì‹¤í–‰
            init();
        })();
    </script>
</body>
</html>
